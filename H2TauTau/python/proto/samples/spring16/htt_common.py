from CMGTools.RootTools.samples.samples_13TeV_RunIISpring16MiniAODv2 import DYJetsToLL_M50, WJetsToLNu,  WWTo2L2Nu, ZZ, WZ,  QCD_Mu5, TBar_tWch, T_tWch, QCDPtEMEnriched, QCDPtbcToE, TBarToLeptons_tch_powheg, DYNJets, WNJets, TToLeptons_tch_powheg, DYJetsToLL_M10to50_LO #DYJetsToLL_M50_LO WJetsToLNu_LO

from CMGTools.RootTools.samples.samples_13TeV_RunIISpring16MiniAODv2 import DYJetsToLL_M50_LO_reHLT as DYJetsToLL_M50_LO
from CMGTools.RootTools.samples.samples_13TeV_RunIISpring16MiniAODv2 import WJetsToLNu_LO_reHLT as WJetsToLNu_LO
# WJetsToLNu_HT100to200, WJetsToLNu_HT200to400, WJetsToLNu_HT400to600, WJetsToLNu_HT600toInf, QCD_Mu15,  DYJetsToTauTau_M150_LO, 
from CMGTools.RootTools.samples.samples_13TeV_RunIISpring16MiniAODv2 import TT_pow_ext3 as TT_pow_ext
from CMGTools.RootTools.samples.samples_13TeV_DATA2016 import SingleMuon_Run2016B_PromptReco_v2, SingleElectron_Run2016B_PromptReco_v2, MuonEG_Run2016B_PromptReco_v2, Tau_Run2016B_PromptReco_v2
from CMGTools.RootTools.samples.samples_13TeV_DATA2016 import SingleMuon_Run2016C_PromptReco_v2, SingleElectron_Run2016C_PromptReco_v2, MuonEG_Run2016C_PromptReco_v2, Tau_Run2016C_PromptReco_v2
from CMGTools.RootTools.samples.samples_13TeV_DATA2016 import SingleMuon_Run2016D_PromptReco_v2, SingleElectron_Run2016D_PromptReco_v2, MuonEG_Run2016D_PromptReco_v2, Tau_Run2016D_PromptReco_v2
from CMGTools.RootTools.samples.samples_13TeV_DATA2016 import SingleMuon_Run2016G_PromptReco_v1, SingleElectron_Run2016G_PromptReco_v1, MuonEG_Run2016G_PromptReco_v1, Tau_Run2016G_PromptReco_v1
from CMGTools.RootTools.samples.samples_13TeV_DATA2016_AZH import DoubleMuon_Run2016B_03Feb2017_v1, DoubleMuon_Run2016B_03Feb2017_v2, DoubleMuon_Run2016C_03Feb2017_v1, DoubleMuon_Run2016D_03Feb2017_v1, DoubleMuon_Run2016E_03Feb2017_v1, DoubleMuon_Run2016F_03Feb2017_v1, DoubleMuon_Run2016G_03Feb2017_v1, DoubleMuon_Run2016H_03Feb2017_v1, DoubleMuon_Run2016H_03Feb2017_v2
from CMGTools.RootTools.samples.samples_13TeV_DATA2016_AZH import DoubleEG_Run2016B_03Feb2017_v1, DoubleEG_Run2016B_03Feb2017_v2, DoubleEG_Run2016C_03Feb2017_v1, DoubleEG_Run2016D_03Feb2017_v1, DoubleEG_Run2016E_03Feb2017_v1, DoubleEG_Run2016F_03Feb2017_v1, DoubleEG_Run2016G_03Feb2017_v1, DoubleEG_Run2016H_03Feb2017_v1, DoubleEG_Run2016H_03Feb2017_v2
from CMGTools.RootTools.samples.samples_13TeV_DATA2016_AZH import *

#dataSamples_DoubleMu_AZH, dataSamples_DoubleEl_AZH

from CMGTools.RootTools.samples.samples_13TeV_RunIISpring16MiniAODv2 import ZZTo4L, WZTo1L3Nu, WWTo1L1Nu2Q, WZTo1L1Nu2Q, ZZTo2L2Q, WZTo2L2Q, VVTo2L2Nu, WZTo3LNu, WZTo3LNu_amcatnlo


# from CMGTools.RootTools.samples.samples_13TeV_RunIISpring16MiniAODv2 import DYJetsToLL_M10to50_ext1
# DY1JetsToLL_M50_LO, DY2JetsToLL_M50_LO, DY3JetsToLL_M50_LO, DY4JetsToLL_M50_LO,

from CMGTools.H2TauTau.proto.samples.spring16.higgs import HiggsGGH125, HiggsVBF125, HiggsTTH125, HiggsZH125
from CMGTools.H2TauTau.proto.samples.spring16.higgs_susy import mc_higgs_susy_gg, mc_higgs_susy_bb, mc_higgs_azh #, mc_higgs_azh_bkg

from CMGTools.H2TauTau.proto.samples.spring16.higgs_susy import HiggsSUSYGG160 as ggh160
from CMGTools.H2TauTau.proto.samples.spring16.higgs_susy import HiggsAZH300 as azh300
from CMGTools.H2TauTau.proto.samples.spring16.higgs_susy import HiggsZZTo4lv1, HiggsZZTo4lv2, HiggsGGToZZ2e2m, HiggsGGToZZ2e2t, HiggsGGToZZ2m2t, HiggsGGToZZ4m, HiggsGGToZZ4e, HiggsGGToZZ4t, HiggsWZv1, HiggsWZv2, HiggsTT, HiggsDY50v1, HiggsDY50v2, HiggsDY50_1JET, HiggsDY50_2JET, HiggsDY50_3JET, HiggsDY50_4JET
from CMGTools.H2TauTau.proto.samples.spring16.higgs_susy import HiggsWZ_min01, WZJ, WZ, HiggsAZH220, HiggsAZH240, HiggsAZH260, HiggsAZH280, HiggsAZH320, HiggsAZH340, HiggsAZH350, HiggsAZH400, HiggsSM, HiggsttZ, HiggsWWW, HiggsWWZ, HiggsWZZ, HiggsZZZ, HiggsTTW, ZHv1, ZHv2, WHplusv1, WHplusv2, WHminv1, WHminv2, ttH


# 21 July

json = '/afs/cern.ch/cms/CAF/CMSCOMM/COMM_DQM/certification/Collisions16/13TeV/Cert_271036-276811_13TeV_PromptReco_Collisions16_JSON.txt'
lumi = 12918.1407


# 15 November
json = '/afs/cern.ch/cms/CAF/CMSCOMM/COMM_DQM/certification/Collisions16/13TeV/Cert_271036-284044_13TeV_PromptReco_Collisions16_JSON_NoL1T.txt'
# lumi = 36220.


# lumi_2016G = 1659.026988066 # 2016 G
lumi_2016G = 1080.463515944 # 2016 G HLT_IsoMu22_v3

#AZH

json_AZH = '/afs/cern.ch/cms/CAF/CMSCOMM/COMM_DQM/certification/Collisions16/13TeV/ReReco/Final/Cert_271036-284044_13TeV_23Sep2016ReReco_Collisions16_JSON.txt'
lumi_AZH = 35870.

json_tt = json
lumi_tt = lumi

# Set cross sections to HTT values

VVTo2L2Nu.xSection = 11.95
WWTo1L1Nu2Q.xSection = 49.997
ZZTo2L2Q.xSection = 3.22
ZZTo4L.xSection = 1.212
WZTo3LNu_amcatnlo.xSection = 5.26
WZTo2L2Q.xSection = 5.595
WZTo1L3Nu.xSection = 3.05
WZTo1L1Nu2Q.xSection = 10.71

w_xsec = 61526.7
dy_xsec = 5765.4

DYJetsToLL_M50_LO.xSection = dy_xsec
DYJetsToLL_M50.xSection = dy_xsec

DYJetsToLL_M50_LO.nevents = [1000.] # Temporary entry
WJetsToLNu_LO.nevents = [1000.] # Temporary entry

# From https://twiki.cern.ch/twiki/pub/CMS/HiggsToTauTauWorking2015/DYNjetWeights.xls r3
dy_weight_dict = {
    (0, 0): 0.669144882/dy_xsec,
    (0, 150): 0.001329134/dy_xsec,
    (1, 0): 0.018336763/dy_xsec,
    (1, 150): 0.001241603/dy_xsec,
    (2, 0): 0.019627356/dy_xsec,
    (2, 150): 0.001247156/dy_xsec,
    (3, 0): 0.021024291/dy_xsec,
    (3, 150): 0.001252443/dy_xsec,
    (4, 0): 0.015530181/dy_xsec,
    (4, 150): 0.001226594/dy_xsec,
}

def getDYWeight(n_jets, m_gen):
    if m_gen > 150.:
        return dy_weight_dict[(n_jets, 150)]
    return dy_weight_dict[(n_jets, 0)]

for sample in [DYJetsToLL_M50_LO] + DYNJets: # + [DYJetsToTauTau_M150_LO]:
    # sample.fractions = [0.7, 0.204374, 0.0671836, 0.0205415, 0.0110539]

    sample.weight_func = getDYWeight
    sample.xSection = dy_xsec

# From https://twiki.cern.ch/twiki/pub/CMS/HiggsToTauTauWorking2015/DYNjetWeights.xls r3
w_weight_dict = {
    0:1.304600668/w_xsec,
    1:0.216233816/w_xsec,
    2:0.115900663/w_xsec,
    3:0.058200264/w_xsec,
    4:0.06275589/w_xsec
}

def getWWeight(n_jets, m_gen_dummy):
    return w_weight_dict[n_jets]

for sample in [WJetsToLNu_LO] + WNJets: # 

    sample.weight_func = getWWeight
    # sample.xSection = w_xsec

WJetsHT = [] # WJetsToLNu_HT100to200, WJetsToLNu_HT200to400, WJetsToLNu_HT400to600, WJetsToLNu_HT600toInf

# Backgrounds
diboson_lo = [ZZ, WZ]
diboson_nlo = [ZZTo4L, WZTo1L3Nu, WWTo1L1Nu2Q, ZZTo2L2Q,  WZTo2L2Q, WZTo1L1Nu2Q, VVTo2L2Nu, WZTo3LNu_amcatnlo]

essential = [TT_pow_ext, DYJetsToLL_M50_LO, DYJetsToLL_M10to50_LO, TBar_tWch, T_tWch, TBarToLeptons_tch_powheg, TToLeptons_tch_powheg, WJetsToLNu_LO]  # WJetsToLNu, 

# Build default background list
backgrounds = essential
backgrounds += DYNJets
# backgrounds += [DYJetsToTauTau_M150_LO, DYJetsToLL_M10to50_ext1]
backgrounds += WNJets
backgrounds += diboson_nlo
backgrounds += []

backgrounds_mu = backgrounds[:]
# backgrounds_mu += [QCD_Mu15]

backgrounds_ele = backgrounds[:]
backgrounds_ele += QCDPtEMEnriched
backgrounds_ele += QCDPtbcToE

# Data
data_single_muon = [SingleMuon_Run2016B_PromptReco_v2, SingleMuon_Run2016C_PromptReco_v2, SingleMuon_Run2016D_PromptReco_v2, SingleMuon_Run2016G_PromptReco_v1]
data_single_electron = [SingleElectron_Run2016B_PromptReco_v2, SingleElectron_Run2016C_PromptReco_v2, SingleElectron_Run2016D_PromptReco_v2]
data_muon_electron = [MuonEG_Run2016B_PromptReco_v2, MuonEG_Run2016C_PromptReco_v2, MuonEG_Run2016D_PromptReco_v2]
data_tau = [Tau_Run2016B_PromptReco_v2, Tau_Run2016C_PromptReco_v2, Tau_Run2016D_PromptReco_v2] #, ]

for sample in data_single_muon + data_single_electron + data_muon_electron + data_tau:
    sample.json = json_AZH
    sample.lumi = lumi_AZH if sample != SingleMuon_Run2016G_PromptReco_v1 else lumi_2016G
    #print "JES"

#Data AZH

data_AZH = [DoubleMuon_Run2016B_03Feb2017_v1, DoubleMuon_Run2016B_03Feb2017_v2, DoubleMuon_Run2016C_03Feb2017_v1, DoubleMuon_Run2016D_03Feb2017_v1, DoubleMuon_Run2016E_03Feb2017_v1, DoubleMuon_Run2016F_03Feb2017_v1, DoubleMuon_Run2016G_03Feb2017_v1, DoubleMuon_Run2016H_03Feb2017_v1, DoubleMuon_Run2016H_03Feb2017_v2, DoubleEG_Run2016B_03Feb2017_v1, DoubleEG_Run2016B_03Feb2017_v2, DoubleEG_Run2016C_03Feb2017_v1, DoubleEG_Run2016D_03Feb2017_v1, DoubleEG_Run2016E_03Feb2017_v1, DoubleEG_Run2016F_03Feb2017_v1, DoubleEG_Run2016G_03Feb2017_v1, DoubleEG_Run2016H_03Feb2017_v1, DoubleEG_Run2016H_03Feb2017_v2]
data_AZH_single = [SingleMuon_Run2016B_03Feb2017_v1,SingleMuon_Run2016B_03Feb2017_v2,SingleMuon_Run2016C_03Feb2017_v1,SingleMuon_Run2016D_03Feb2017_v1,SingleMuon_Run2016E_03Feb2017_v1,SingleMuon_Run2016F_03Feb2017_v1,SingleMuon_Run2016G_03Feb2017_v1,SingleMuon_Run2016H_03Feb2017_v1,SingleMuon_Run2016H_03Feb2017_v2,SingleEG_Run2016B_03Feb2017_v1,SingleEG_Run2016B_03Feb2017_v2,SingleEG_Run2016C_03Feb2017_v1,SingleEG_Run2016D_03Feb2017_v1,SingleEG_Run2016E_03Feb2017_v1,SingleEG_Run2016F_03Feb2017_v1,SingleEG_Run2016G_03Feb2017_v1,SingleEG_Run2016H_03Feb2017_v1,SingleEG_Run2016H_03Feb2017_v2]

for sample in data_AZH + data_AZH_single:
    sample.json = json_AZH
    sample.lumi = lumi_AZH   
    
#for sample in data_AZH_single:
#    print sample.json
#    print sample.lumi

# Signals
sm_signals = [HiggsGGH125, HiggsVBF125, HiggsTTH125]
mssm_signals = mc_higgs_susy_bb + mc_higgs_susy_gg

#azh_bkg = mc_higgs_azh_bkg ##+ DYJetsToLL_M50

sync_list = []


#for sm sync
#sync_list = [azh340] 
#sync_list = [azh300]
#for mssm sync
#sync_list = [ggh160]
#for background syncs
#sync_list=[DYJetsToLL_M50, WZTo3LNu_amcatnlo]
DY_sync_list = [HiggsDY50v1, HiggsDY50v2, HiggsDY50_1JET, HiggsDY50_2JET, HiggsDY50_3JET, HiggsDY50_4JET]
WZ_sync_list = [HiggsWZv1, HiggsWZv2, HiggsWZ_min01, WZJ, WZ]
#sync_list=[HiggsZZTo4l, HiggsGGToZZ2e2m, HiggsGGToZZ2e2t, HiggsGGToZZ2m2t, HiggsGGToZZ4m, HiggsGGToZZ4e, HiggsGGToZZ4t, HiggsWZv1, HiggsWZv2, HiggsTT, HiggsDY50v1, HiggsDY50v2, HiggsDY50_1JET, HiggsDY50_2JET, HiggsDY50_3JET, HiggsDY50_4JET]
#sync_list = [azh_bkg]


#control list
Higgses = [HiggsTTH125, HiggsZH125]
TTW_control = [HiggsTTW]
DY_control = [HiggsDY50_1JET, HiggsDY50_2JET, HiggsDY50_3JET, HiggsDY50_4JET]
WZ_control = [HiggsWZ_min01]
TT_control = [HiggsTT]
ZZ_control = [HiggsZZTo4lv1, HiggsZZTo4lv2]
SM_control = [HiggsSM]
ttZ_control = [HiggsttZ]
DY_inc = [HiggsDY50v1, HiggsDY50v2]
DY_all = DY_control + DY_inc
GG2ZZ_control = [HiggsGGToZZ2e2m, HiggsGGToZZ2e2t, HiggsGGToZZ2m2t, HiggsGGToZZ4m, HiggsGGToZZ4e, HiggsGGToZZ4t]
triboson = [HiggsWWW, HiggsWWZ, HiggsWZZ, HiggsZZZ]
AZH_extra = [HiggsTTW, ZHv1, ZHv2, WHplusv1, WHplusv2, WHminv1, WHminv2, ttH]
AZH_masses = [HiggsAZH220, HiggsAZH240, azh300, HiggsAZH260, HiggsAZH280, HiggsAZH320, HiggsAZH340, HiggsAZH350, HiggsAZH400]
AZH_FR = WZ_control + DY_control + TT_control
AZH_control = WZ_control + DY_control + TT_control + ZZ_control + SM_control + ttZ_control + GG2ZZ_control + triboson + AZH_extra + AZH_masses
 ###+ SM_control #+ sync_list 
AZH_tight = TT_control + ZZ_control #+ ZZ_control2
AZH_data =  data_AZH + data_AZH_single
AZH_data_single = data_AZH_single
AZH_test = [HiggsDY50v1, azh300]
sync_list = AZH_masses
